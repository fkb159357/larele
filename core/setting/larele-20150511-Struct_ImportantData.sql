/*
Navicat MySQL Data Transfer

Source Server         : localhost
Source Server Version : 50516
Source Host           : localhost:3306
Source Database       : larele

Target Server Type    : MYSQL
Target Server Version : 50516
File Encoding         : 65001

Date: 2015-05-11 13:42:27
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for `lr_posts`
-- ----------------------------
DROP TABLE IF EXISTS `lr_posts`;
CREATE TABLE `lr_posts` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(50) COLLATE utf8_unicode_ci DEFAULT NULL,
  `content` text COLLATE utf8_unicode_ci,
  `raw_content` text COLLATE utf8_unicode_ci,
  `create_time` int(10) unsigned zerofill DEFAULT NULL,
  `update_time` int(10) unsigned zerofill DEFAULT NULL,
  `uid` int(10) unsigned DEFAULT NULL,
  `urlalia` varchar(50) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '链接别名',
  `sort` tinyint(4) NOT NULL DEFAULT '0' COMMENT '排序值，越小越优先(这样设计更方便)',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Records of lr_posts
-- ----------------------------
INSERT INTO `lr_posts` VALUES ('1', '开通啦（nothing!）', '放大放大机送飞机上的哦饭店四季覅的送积分的东覅地方时间覅都是\r\n\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034669.jpeg\">\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034668.jpeg\">\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034667.jpeg\">\r\n<img width=\"35\" src=\"http://i2.tietuku.com/df29535ea37f81ce.jpg\">', '放大放大机送飞机上的哦饭店四季覅的送积分的东覅地方时间覅都是\r\n\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034669.jpeg\">\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034668.jpeg\">\r\n<img width=\"35\" src=\"http://img.kusha.biz/upload/image/20150323/32305034667.jpeg\">\r\n<img width=\"35\" src=\"http://i2.tietuku.com/df29535ea37f81ce.jpg\">', '1429300450', '1430064642', '1', 'huang', '99');
INSERT INTO `lr_posts` VALUES ('2', '第一帖的标题fdsfdsfdsf11122145165', '第一帖的内容fdsfdsdsfdsffdsfdsfdsfsdfd\r\n', '第一帖的内容fdsfdsdsfdsffdsfdsfdsfsdfd\r\n', '1429299673', '1429376334', '1', 'ppppfdsfdsfdsdfdsf7777', '99');
INSERT INTO `lr_posts` VALUES ('3', 'Tiles Missing', '<iframe width=\"100%\" height=\"750\" src=\"./?test.tiles\" style=\"border:0; \"></iframe>', '<iframe width=\"100%\" height=\"750\" src=\"./?test.tiles\" style=\"border:0; \"></iframe>', '1429307329', '1429475627', '1', 'tiles', '1');
INSERT INTO `lr_posts` VALUES ('4', 'WYSIWYG编辑器', '<h1>432432</h1><div style=\"background-color:black;width:100px;height:100px;\"></div>bootstrap-wysiwyg \r\n为Bootstrap定制的微型所见即所得（What you see is what you get）富文本编辑器\r\n\r\n<h1>bootstrap-wysiwyg <br> <small>为Bootstrap定制的微型所见即所得（What you see is what you get）富文本编辑器</small></h1>1', '<h1>432432</h1><div style=\"background-color:black;width:100px;height:100px;\"></div>bootstrap-wysiwyg \r\n为Bootstrap定制的微型所见即所得（What you see is what you get）富文本编辑器\r\n\r\n<h1>bootstrap-wysiwyg <br> <small>为Bootstrap定制的微型所见即所得（What you see is what you get）富文本编辑器</small></h1>1', '1429306833', '1429376466', '1', '', '4');
INSERT INTO `lr_posts` VALUES ('5', 'Doinject Shell Console', '<iframe name=\"posts-5-shell\" id=\"posts-5-shell\" src=\"./?shell.shell&rate=55\" width=\"100%\" height=\"500\" style=\"border:0; \"></iframe>\r\n<script>\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n</script>\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"./?shell.shell\" target=\"_blank\">GOTO</a>', '<iframe name=\"posts-5-shell\" id=\"posts-5-shell\" src=\"./?shell.shell&rate=55\" width=\"100%\" height=\"500\" style=\"border:0; \"></iframe>\r\n<script>\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n</script>\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"./?shell.shell\" target=\"_blank\">GOTO</a>', '1429341326', '1429483621', '1', '', '2');
INSERT INTO `lr_posts` VALUES ('6', '让你们见识一下啥叫金馆鱼', '让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼\r\n<script src=\"./res/biz/other/jinguanyu.js\"></script>\r\n<script>\'posts/content\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() && Anime.Jinguanyu.test()</script>', '让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼让你们见识一下啥叫金馆鱼\r\n<script src=\"./res/biz/other/jinguanyu.js\"></script>\r\n<script>\'posts/content\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() && Anime.Jinguanyu.test()</script>', '1429306717', '1429376399', '1', '', '3');
INSERT INTO `lr_posts` VALUES ('7', 'FM', '<a class=\"btn btn-raised\" href=\"http://iio.ooo\" target=\"_blank\">IIO.OOO</a>\r\n\r\n<iframe src=\"//iio.ooo\" width=\"100%\" height=\"700px\" style=\"border:0; \"></iframe>', '<a class=\"btn btn-raised\" href=\"http://iio.ooo\" target=\"_blank\">IIO.OOO</a>\r\n\r\n<iframe src=\"//iio.ooo\" width=\"100%\" height=\"700px\" style=\"border:0; \"></iframe>', '1429360042', '1429624246', '1', '', '3');
INSERT INTO `lr_posts` VALUES ('8', 'Clock', '<iframe id=\"posts-8-clock\" width=\"50%\" height=\"450\" src=\"./?test.clock\" style=\"border:0; margin-left: 200px; \"></iframe>\r\n<script>\r\n$(function(){\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-8-clock\').parent().parent().css(\'background-color\', \'black\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-8-clock\').parent().css(\'background-color\', \'black\');\r\n})\r\n</script>\r\n', '<iframe id=\"posts-8-clock\" width=\"50%\" height=\"450\" src=\"./?test.clock\" style=\"border:0; margin-left: 200px; \"></iframe>\r\n<script>\r\n$(function(){\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-8-clock\').parent().parent().css(\'background-color\', \'black\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-8-clock\').parent().css(\'background-color\', \'black\');\r\n})\r\n</script>\r\n', '1429368945', '1429376370', '1', 'clock', '99');
INSERT INTO `lr_posts` VALUES ('9', 'Line Net', '<iframe id=\"posts-9-linenet\" width=\"100%\" height=\"800\" src=\"./?test.linenet\" style=\"border:0; \"></iframe>\r\n<script>\r\n$(function(){\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-9-linenet\').parent().parent().css(\'background-color\', \'black\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-9-linenet\').parent().css(\'background-color\', \'black\');\r\n\r\n});\r\n</script>', '<iframe id=\"posts-9-linenet\" width=\"100%\" height=\"800\" src=\"./?test.linenet\" style=\"border:0; \"></iframe>\r\n<script>\r\n$(function(){\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-9-linenet\').parent().parent().css(\'background-color\', \'black\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-9-linenet\').parent().css(\'background-color\', \'black\');\r\n\r\n});\r\n</script>', '1429374815', '1429376255', '1', '', '99');
INSERT INTO `lr_posts` VALUES ('10', '排序潜规则', '<div class=\"row-fluid\">\r\n新发表的，排序值默认为零，排最前，其他值：越小越靠前。<br>\r\n相同排序值的，越晚发布，越靠前<br>\r\n\r\n一般对于不注重顺序的条目，可设置其为999或99，需要排序的条目从1开始设置。<br>\r\n</div>', '<div class=\"row-fluid\">\r\n新发表的，排序值默认为零，排最前，其他值：越小越靠前。<br>\r\n相同排序值的，越晚发布，越靠前<br>\r\n\r\n一般对于不注重顺序的条目，可设置其为999或99，需要排序的条目从1开始设置。<br>\r\n</div>', '1429376487', '1429636078', '1', '', '99');
INSERT INTO `lr_posts` VALUES ('11', '测试动态插件生成', '<iframe id=\"posts-11-plugin\" name=\"posts-11-plugin\" width=\"0\" height=\"0\">\r\n</iframe>\r\n                        <form class=\"form-horizontal\" method=\"post\" action=\"./\" target=\"posts-11-plugin\">\r\n                            <input type=\"hidden\" name=\"test/plugin\">\r\n                            <fieldset>\r\n                                <legend align=\"right\">动态插件</legend>\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"path\" class=\"col-lg-2 control-label\">目标路径</label>\r\n                                    <div class=\"col-lg-10\">\r\n                                        <input type=\"text\" class=\"form-control\" id=\"path\" name=\"path\" placeholder=\"目标路径\">\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"code\" class=\"col-lg-2 control-label\">插件代码</label>\r\n                                    <div class=\"col-lg-10\">\r\n                                        <input type=\"code\" class=\"form-control\" id=\"code\" name=\"code\" placeholder=\"插件代码\">\r\n                                        <div class=\"checkbox\">\r\n                                            <label>\r\n                                                <input type=\"checkbox\"> 我是老司机\r\n                                            </label>\r\n                                        </div>\r\n                                        <br>\r\n                                        <div class=\"togglebutton\">\r\n                                            <label>\r\n                                                <input type=\"checkbox\" checked=\"checked\"> 求跟踪\r\n                                            </label>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"form-group\">\r\n                                    <div class=\"col-lg-10 col-lg-offset-2\">\r\n                                        <button type=\"submit\" class=\"btn btn-primary\">生 成！</button>\r\n                                    </div>\r\n                                </div>\r\n                            </fieldset>\r\n                        </form>\r\n\r\n<script>\r\n$(function(){\r\n\r\nsetTimeout(function(){\r\n    $(\'#posts-11-plugin\').parent().parent().unbind(\'click\').find(\'.diy-posts-line-title:eq(0)\').click(function(){location.href=\'./?posts/11\';});\r\n}, 2000);\r\n    \r\n\r\n});\r\n</script>', '<iframe id=\"posts-11-plugin\" name=\"posts-11-plugin\" width=\"0\" height=\"0\">\r\n</iframe>\r\n                        <form class=\"form-horizontal\" method=\"post\" action=\"./\" target=\"posts-11-plugin\">\r\n                            <input type=\"hidden\" name=\"test/plugin\">\r\n                            <fieldset>\r\n                                <legend align=\"right\">动态插件</legend>\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"path\" class=\"col-lg-2 control-label\">目标路径</label>\r\n                                    <div class=\"col-lg-10\">\r\n                                        <input type=\"text\" class=\"form-control\" id=\"path\" name=\"path\" placeholder=\"目标路径\">\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"form-group\">\r\n                                    <label for=\"code\" class=\"col-lg-2 control-label\">插件代码</label>\r\n                                    <div class=\"col-lg-10\">\r\n                                        <input type=\"code\" class=\"form-control\" id=\"code\" name=\"code\" placeholder=\"插件代码\">\r\n                                        <div class=\"checkbox\">\r\n                                            <label>\r\n                                                <input type=\"checkbox\"> 我是老司机\r\n                                            </label>\r\n                                        </div>\r\n                                        <br>\r\n                                        <div class=\"togglebutton\">\r\n                                            <label>\r\n                                                <input type=\"checkbox\" checked=\"checked\"> 求跟踪\r\n                                            </label>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                                <div class=\"form-group\">\r\n                                    <div class=\"col-lg-10 col-lg-offset-2\">\r\n                                        <button type=\"submit\" class=\"btn btn-primary\">生 成！</button>\r\n                                    </div>\r\n                                </div>\r\n                            </fieldset>\r\n                        </form>\r\n\r\n<script>\r\n$(function(){\r\n\r\nsetTimeout(function(){\r\n    $(\'#posts-11-plugin\').parent().parent().unbind(\'click\').find(\'.diy-posts-line-title:eq(0)\').click(function(){location.href=\'./?posts/11\';});\r\n}, 2000);\r\n    \r\n\r\n});\r\n</script>', '1429425735', '1429475644', '1', '', '1');
INSERT INTO `lr_posts` VALUES ('12', '最简单的登录验证模型', '<code>\r\n<pre>\r\n            if (! session_exists(\'auth\') && ! ($right = \'balabala\' == arg(\'password\'))) {\r\n	        putalert(\'auth failed\');\r\n	    } else {\r\n	        @$right && session(\'auth\', true);\r\n	    }\r\n	    print \'auth success\';\r\n</pre>\r\n</code>', '<code>\r\n<pre>\r\n            if (! session_exists(\'auth\') && ! ($right = \'balabala\' == arg(\'password\'))) {\r\n	        putalert(\'auth failed\');\r\n	    } else {\r\n	        @$right && session(\'auth\', true);\r\n	    }\r\n	    print \'auth success\';\r\n</pre>\r\n</code>', '1429430356', '1429637055', '1', '', '99');
INSERT INTO `lr_posts` VALUES ('13', '怎么加特技呢', '现在来示范一下\r\n\r\n<audio id=\"posts-13-duang\" src=\"http://data6.5sing.kgimg.com/T1iHCbBXCT1R47IVrK.mp3\"  loop></audio>\r\n\r\n<script>\r\n\r\n$(function(){\r\n\r\n \'posts/content\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() && $(\'#posts-13-duang\')[0].play();\r\n\r\n});\r\n\r\n</script>', '现在来示范一下\r\n\r\n<audio id=\"posts-13-duang\" src=\"http://data6.5sing.kgimg.com/T1iHCbBXCT1R47IVrK.mp3\"  loop></audio>\r\n\r\n<script>\r\n\r\n$(function(){\r\n\r\n \'posts/content\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() && $(\'#posts-13-duang\')[0].play();\r\n\r\n});\r\n\r\n</script>', '1429460813', '1429484401', '1', 'duang', '0');
INSERT INTO `lr_posts` VALUES ('14', '普通人发的东西（XSS脚本被过滤）', '\n<p>\r\n\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&amp;rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"http://./?shell.shell\" target=\"_blank\">GOTO</a></p>\n', '<p>\r\n\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"http://./?shell.shell\" target=\"_blank\">GOTO</a></p>\r\n', '1429483466', '1429483527', '3', '', '99');
INSERT INTO `lr_posts` VALUES ('15', '普通人发的第二贴', '\n<p>范德萨范德萨发都是范德萨爱上</p>\r\n测试特殊内容\r\n\r\n\r\n\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&amp;rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n$op ? putalert(null, url(\"posts/edit/{$id}\")) : putalert(\'failed\');//failed on 0 or false\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"http://./?shell.shell\" target=\"_blank\">GOTO</a>\n', '<p>范德萨范德萨发都是范德萨爱上</p>\r\n测试特殊内容\r\n\r\n\r\n\r\n$(function(){\r\n    //var link = $(window[\'posts-5-shell\'].document).find(\'link:first\'); \r\n    //var pre = \'./?shell.shell-css&rate=\'; \r\n    //var rate = parseFloat(link.attr(\'href\').replace(pre, \'\')) * 1.5; \r\n    //link.attr(\'href\', pre + rate); \r\n    //link.end()[0].location.reload()\r\n    //window[\'posts-19-iframe\'].location.search\r\n    //(shell_css_matches=window[\'posts-5-shell\'].location.search.match(/rate=[0-9]+(.[0-9]{1,})?/)) ? shell_css_matches[0].replace(\'rate=\', \'\') : \'\'\r\n\r\n    \'posts/getlist\'==$(\'#dataStore\').data(\'tpl\').toLowerCase() ? $(\'#posts-5-shell\').parent().parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\').children(\'.diy-posts-line-title\').css(\'color\', \'white\') : $(\'#posts-5-shell\').parent().css(\'background-image\', \'url(res/biz/shell/login_bg_rev.jpg)\');\r\n\r\n})\r\n$op ? putalert(null, url(\"posts/edit/{$id}\")) : putalert(\'failed\');//failed on 0 or false\r\n\r\n<a class=\"btn btn-primary btn-raised\" href=\"http://./?shell.shell\" target=\"_blank\">GOTO</a>\r\n\r\n\r\n<embed src=\"http://assets.dwstatic.com/video/vppp.swf\" allowfullscreen=\"true\" quality=\"high\" height=\"\" width=\"\" align=\"middle\" allowscriptaccess=\"always\" flashvars=\"uu=a04808d307&amp;vu=&amp;auto_play=1&amp;sdk=dw&amp;vid=112007&amp;logo=huya&amp;no_danmu=1&amp;from=huya\" type=\"application/x-shockwave-flash\" style=\"display: block !important; z-index:-1\" wmode=\"transparent\">\r\n', '1429494466', '1429506128', '3', '', '100');
INSERT INTO `lr_posts` VALUES ('16', '发视频', '<embed src=\"http://assets.dwstatic.com/video/vppp.swf\" allowfullscreen=\"true\" quality=\"high\" height=\"462\" width=\"730\" align=\"middle\" allowscriptaccess=\"always\" flashvars=\"uu=a04808d307&vu=&auto_play=0&sdk=dw&vid=112007&logo=huya&no_danmu=1&from=huya&no_ad=1\" type=\"application/x-shockwave-flash\" style=\"display: block !important; z-index:-1\" wmode=\"transparent\">', '<embed src=\"http://assets.dwstatic.com/video/vppp.swf\" allowfullscreen=\"true\" quality=\"high\" height=\"462\" width=\"730\" align=\"middle\" allowscriptaccess=\"always\" flashvars=\"uu=a04808d307&vu=&auto_play=0&sdk=dw&vid=112007&logo=huya&no_danmu=1&from=huya&no_ad=1\" type=\"application/x-shockwave-flash\" style=\"display: block !important; z-index:-1\" wmode=\"transparent\">', '1429506201', '1429719489', '1', '', '127');
INSERT INTO `lr_posts` VALUES ('17', '断网十多天，现在终于能上了', '断了好几天，4月番都不知道从哪开始补了。。。\r\n\r\n<img src=\"./res/biz/other/jinguanyu.gif\">\r\n\r\n<div class=\"t_fsz\">\r\n<table cellspacing=\"0\" cellpadding=\"0\"><tr><td class=\"t_f\" id=\"postmessage_25059\">\r\n<br />\r\n<img id=\"aimg_J0wzD\" class=\"zoom\" src=\"http://i1.tietuku.com/f124f6d285063db8.jpg\"  border=\"0\" alt=\"\" /><br />\r\n<br />\r\n<img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" />去他MEI的睾文门特的网*@@~线*￥￥整$*改。\\\\\\\\<br />\r\n<br />\r\n断了几天都不知道从哪开始补番了。。<br />\r\n<br />\r\n好像11年出的战姬绝唱不错（（（看声优阵容，其实我是准备听里面出的唱片的~~<img src=\"http://www.kusha.biz/static/image/smiley/yasina/26.jpg\" smilieid=\"210\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n另外祈Inory酱翻的光の旋律不错，去看了对应的番《空之音》，感觉应该会比较耐看。<br />\r\n大概这阵子要补旧番就补这两块吧。<img src=\"http://www.kusha.biz/static/image/smiley/yasina/31.jpg\" smilieid=\"203\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n最后，有个机器快到续费期了，就随便挂个东西上去，现在没什么东西，<a href=\"http://ltre.me\" target=\"_blank\">http://ltre.me</a>，以后会转移到<a href=\"http://larele.com或者iio.ooo\" target=\"_blank\">http://larele.com或者iio.ooo</a><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_109.gif\" smilieid=\"122\" border=\"0\" alt=\"\" /><br />\r\n<strike>想黑的话可以，不过黑完在<a href=\"http://www.kusha.biz/thread-3647-1-1.html\">这里回帖</a>告诉我是怎么黑的。</strike> <img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n<br />\r\n<br />\r\n<br />\r\n</td></tr></table>\r\n</div>\r\n', '断了好几天，4月番都不知道从哪开始补了。。。\r\n\r\n<img src=\"./res/biz/other/jinguanyu.gif\">\r\n\r\n<div class=\"t_fsz\">\r\n<table cellspacing=\"0\" cellpadding=\"0\"><tr><td class=\"t_f\" id=\"postmessage_25059\">\r\n<br />\r\n<img id=\"aimg_J0wzD\" class=\"zoom\" src=\"http://i1.tietuku.com/f124f6d285063db8.jpg\"  border=\"0\" alt=\"\" /><br />\r\n<br />\r\n<img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" />去他MEI的睾文门特的网*@@~线*￥￥整$*改。\\\\\\\\<br />\r\n<br />\r\n断了几天都不知道从哪开始补番了。。<br />\r\n<br />\r\n好像11年出的战姬绝唱不错（（（看声优阵容，其实我是准备听里面出的唱片的~~<img src=\"http://www.kusha.biz/static/image/smiley/yasina/26.jpg\" smilieid=\"210\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n另外祈Inory酱翻的光の旋律不错，去看了对应的番《空之音》，感觉应该会比较耐看。<br />\r\n大概这阵子要补旧番就补这两块吧。<img src=\"http://www.kusha.biz/static/image/smiley/yasina/31.jpg\" smilieid=\"203\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n最后，有个机器快到续费期了，就随便挂个东西上去，现在没什么东西，<a href=\"http://ltre.me\" target=\"_blank\">http://ltre.me</a>，以后会转移到<a href=\"http://larele.com或者iio.ooo\" target=\"_blank\">http://larele.com或者iio.ooo</a><img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_109.gif\" smilieid=\"122\" border=\"0\" alt=\"\" /><br />\r\n<strike>想黑的话可以，不过黑完在<a href=\"http://www.kusha.biz/thread-3647-1-1.html\">这里回帖</a>告诉我是怎么黑的。</strike> <img src=\"http://www.kusha.biz/static/image/smiley/Other/Other_113.jpg\" smilieid=\"149\" border=\"0\" alt=\"\" /><br />\r\n<br />\r\n<br />\r\n<br />\r\n<br />\r\n</td></tr></table>\r\n</div>\r\n', '1429631498', '1430275302', '1', 'caodan', '0');
INSERT INTO `lr_posts` VALUES ('18', '把路由重写的算法撸出来了', '<td class=\"plc\">\r\n<div class=\"pi\">\r\n<div id=\"fj\" class=\"y\">\r\n<label class=\"z\">电梯直达</label>\r\n<input type=\"text\" class=\"px p_fre z\" size=\"2\" onkeyup=\"$(\'fj_btn\').href=\'forum.php?mod=redirect&amp;ptid=3618&amp;authorid=0&amp;postno=\'+this.value\" onkeydown=\"if(event.keyCode==13) {window.location=$(\'fj_btn\').href;return false;}\" title=\"跳转到指定楼层\">\r\n<a href=\"javascript:;\" id=\"fj_btn\" class=\"z\" title=\"跳转到指定楼层\"><img src=\"http://www.kusha.biz/static/image/common/fj_btn.png\" alt=\"跳转到指定楼层\" class=\"vm\"></a>\r\n</div>\r\n<strong>\r\n<a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;fromuid=20\" title=\"您的朋友访问此链接后，您将获得相应的积分奖励\" id=\"postnum24752\" onclick=\"setCopy(this.href, \'帖子地址复制成功\');return false;\">楼主</a>\r\n</strong>\r\n<div class=\"pti\">\r\n<div class=\"pdbt\">\r\n</div>\r\n<div class=\"authi\">\r\n<img class=\"authicn vm\" id=\"authicon24752\" src=\"http://www.kusha.biz/static/image/common/online_admin.gif\">\r\n<em id=\"authorposton24752\">发表于 2015-4-1 01:50:16</em>\r\n<span class=\"pipe\">|</span><a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;page=1&amp;authorid=20\" rel=\"nofollow\">只看该作者</a>\r\n<span class=\"pipe\">|</span><a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;extra=page%3D1&amp;ordertype=1\">倒序浏览</a>\r\n<span class=\"pipe\">|</span>\r\n<a id=\"replynotice\" href=\"http://www.kusha.biz/forum.php?mod=misc&amp;action=replynotice&amp;op=ignore&amp;tid=3618\" status=\"1\" onclick=\"ajaxmenu(this, 3000, 0, 0, \'43\', function () {replyNotice();});return false;\">取消回复通知</a>\r\n</div>\r\n</div>\r\n</div><div class=\"pct\"><style type=\"text/css\">.pcb{margin-right:0}</style><div class=\"pcb\">\r\n<div class=\"t_fsz\">\r\n<table cellspacing=\"0\" cellpadding=\"0\"><tbody><tr><td class=\"t_f\" id=\"postmessage_24752\">\r\n<img id=\"aimg_I9Z7e\" onclick=\"zoom(this, this.src, 0, 0, 0)\" class=\"zoom\" src=\"http://i2.tietuku.com/c1b94d510569e268.jpg\" onmouseover=\"img_onmouseoverfunc(this)\" onload=\"thumbImg(this)\" border=\"0\" alt=\"\" width=\"760\" height=\"427\" style=\"cursor: pointer;\" initialized=\"true\"><br>\r\n<br>\r\n<font size=\"7\">楼顶喂鱼~~~</font><br>\r\n<br>\r\n<br>\r\n<br>\r\n<div align=\"left\">define(\'DI_ROUTE_REWRITE\', <strong>true</strong>); //启用路由重写</div><div align=\"left\">define(\'DI_KILL_ON_FAIL_REWRITE\', <strong>true</strong>);&nbsp;&nbsp;//未匹配重写时，是否终止程序</div><br>\r\n<div align=\"left\"><strong>class </strong>DIRouteRewrite {</div><br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 自定义路由重写规则</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 书写原则，特殊在前，通用在后</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 详见：</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*&nbsp; &nbsp;&nbsp; &nbsp;DIRoute::rewrite() @ __route.php</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>static </strong><i>$rulesMap</i> = <strong>array</strong>(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'://danmucopy.me/t\' =&gt; \'test/test\', //含有域名的配置最好放在最前面(经验之谈)</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'://danmu.me/t\' =&gt; \'test/session\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'fm\' =&gt; \'fm/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about.htm\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about.html\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'s\' =&gt; \'shell.shell\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'s.html\' =&gt; \'shell.shell\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;nums&gt;\' =&gt; \'test/start/&lt;nums&gt;\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;\' =&gt; \'&lt;D&gt;/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.htm\' =&gt; \'&lt;D&gt;/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.html\' =&gt; \'&lt;D&gt;/start\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;/&lt;F&gt;\' =&gt; \'&lt;D&gt;/&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;-&lt;F&gt;\' =&gt; \'&lt;D&gt;/&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.&lt;F&gt;\' =&gt; \'&lt;D&gt;.&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp; );</div><br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 不需要重写的</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 左侧为相对于脚本目录的URI</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 右侧表示重写失败时是否终止程序</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 这些规则不受常量DI_KILL_ON_FAIL_REWRITE影响</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>static </strong><i>$withoutMap</i> = <strong>array</strong>(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.php\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.html\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.htm\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'favicon.ico\' =&gt; <strong>true</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'robots.txt\' =&gt; <strong>true</strong>,</div><div align=\"left\">&nbsp; &nbsp; );</div><br>\r\n<br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 根据自定义规则重写路由。</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 不是所有规则都一定能实现，要看优先级。优先级以数组头部元素为最高</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* “&lt;&gt;”使用单个字母的，表示位置的代号，可实现规则的左右侧关系</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* &lt;num&gt;表示参数值为单数字，&lt;nums&gt;表示参数值为多个数字，&lt;letter&gt;表示参数值为单个字母，&lt;word&gt;表示参数值为多个字母，&lt;var&gt;表示参数值形似变量</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 当不确定需要使用多少参数时，可以考虑使用尾随参数&lt;*&gt;</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* &lt;*&gt;表示尾随参数，值类型任意，从左向右自动追加到规则右侧的尾部。追加尾随参数时，右侧用什么分隔符，就使用什么分隔符来分割参数。</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>private function </strong>rewrite(){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$pureUri = \'/\' == path_prefix() ? uri_prefix() : uri_pure();</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(\'\' === $pureUri) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>return</strong>;//请求中没有有用的URI</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$rules = DIRouteRewrite::<i>$rulesMap</i>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$dontRules = DIRouteRewrite::<i>$withoutMap</i>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$req = url_prefix(\'://\') . $pureUri;</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//以下情况免重写</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(in_array($pureUri, array_keys($dontRules))) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>($dontRules[$pureUri]) <strong>die</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>return</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//开始尝试重写，遇到第一个符合的即确定结果</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>foreach </strong>($rules <strong>as </strong>$k =&gt; $rule) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$kBackup = $k;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>(0 !== stripos($k, \'://\')) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $k = \'://\' . $_SERVER[\'HTTP_HOST\'] . rtrim(dirname($_SERVER[\'SCRIPT_NAME\']), \'\\//\') . \'/\' . $k;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$k = \'/\' . str_ireplace(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>array</strong>(\'\\\\\\\\\', \'://\', \'/\', \'&lt;\', \'&gt;\',&nbsp;&nbsp;\'.\', \'*\'),</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>array</strong>( \'\', \'\', \'\\/\', \'(?&lt;\', \'&gt;\\w+)?\', \'\\.\', \'tailparam\'),</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $k</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;) . \'\\/?$/i\';</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>(preg_match($k, $req, $matchs)) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $checkTypeInNeed = <strong>true</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>foreach</strong>($matchs <strong>as </strong>$matchkey =&gt; $matchval){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$isPosTag = is_letter($matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsLetter = 0 === strcasecmp(\'letter\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsLetter = is_letter($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsWord = 0 === strcasecmp(\'word\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsWord = is_word($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsNum = 0 === strcasecmp(\'num\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsNum = is_a_num($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsNums = 0 === strcasecmp(\'nums\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsNums = is_numeric($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsVar = 0 === strcasecmp(\'var\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsVar = is_var($matchval);</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$typeIsNormal = $keyIsLetter &amp;&amp; $valueIsLetter || $keyIsWord &amp;&amp; $valueIsWord || $keyIsNum &amp;&amp; $valueIsNum || $keyIsNums &amp;&amp; $valueIsNums || $keyIsVar &amp;&amp; $valueIsVar;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>($isPosTag || $typeIsNormal) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$rule = str_ireplace(\"&lt;{$matchkey}&gt;\", $matchval, $rule);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;} <strong>elseif </strong>(\'tailparam\' === $matchkey) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$isDo = count(explode(\'/\', $rule)) &gt;= 2;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$delimiter = $isDo ? \'/\' : \'.\';</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$rule .= $delimiter . $matchval;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//检查需要匹配类型时，是否匹配成功</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>($keyIsLetter&amp;&amp;!$valueIsLetter || $keyIsWord&amp;&amp;!$valueIsWord || $keyIsNum&amp;&amp;!$valueIsNum || $keyIsNums&amp;&amp;!$valueIsNums || $keyIsVar&amp;&amp;!$valueIsVar) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$checkTypeInNeed = <strong>false</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //通过$_SERVER[\'REQUEST_URI\']的关键信息，以及上述规则，来重写$GLOBALS[\'request_args\']的首索引，达到重写路由的目的</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //转化关系：a-b =&gt; a/b, a.b =&gt; a_b</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //使用a-b代替a/b，可以确保前端资源URL的正确性</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //a_b的下划线“_”与URL中QUERY_STRING参数名保持一致写法，在进入route()后，会自动转化为“.”</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>if </strong>($checkTypeInNeed) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$rule = str_replace(<strong>array</strong>(\'-\', \'.\'), <strong>array</strong>(\'/\', \'_\'), $rule);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;array_unshift_withkey($_REQUEST, $rule, \'\');</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>return</strong>; //到此处为重写成功</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }<strong>else </strong>{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$kBackup = str_ireplace(<strong>array</strong>(\'&lt;\',\'&gt;\'), <strong>array</strong>(\'＜\', \'＞\'), $kBackup);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$msg = \"已匹配到重写规则，但URI中的个别部分或参数不与规则中的设定匹配。当前规则：[{$kBackup} =&gt; {$rule}]\";</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>throw new </strong>Exception($msg);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//此处为无任何匹配时的处理。启用DI_KILL_ON_FAIL_REWRITE可以减少被盲点爬虫时消耗的流量</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(DI_KILL_ON_FAIL_REWRITE) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>die</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp; }&nbsp;&nbsp;</div><br>\r\n<br>\r\n<div align=\"left\">}&nbsp;&nbsp;</div><br>\r\n<br>\r\n<div align=\"left\"><font color=\"black\"><font face=\"&amp;quot;\"><font style=\"font-size:24.0pt\">以下是相关的辅助函数：</font></font></font></div><br>\r\n<div align=\"left\">/**</div><div align=\"left\"> * 获取当前执行的WEB目录前缀，截至当前执行目录，头部和尾部有“/”</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;WEB根目录是 /usr/www/，要执行的脚本文件所在路径为/usr/www/aaa/index.php，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则该脚本所在目录相对WEB根目录的路径值为：/aaa/，该值可由此方法得到。</div><div align=\"left\"> */</div><div align=\"left\">function path_prefix(){</div><div align=\"left\">&nbsp; &nbsp; $di_sn = $_SERVER[\'SCRIPT_NAME\'];</div><div align=\"left\">&nbsp; &nbsp; $di_num = strrpos($di_sn, \'/\');</div><div align=\"left\">&nbsp; &nbsp; $di_ppr = substr($di_sn, 1, $di_num);//所在目录的相对路径，如“danmu/”</div><div align=\"left\">&nbsp; &nbsp; return \"/{$di_ppr}\";</div><div align=\"left\">}</div><div align=\"left\">/**</div><div align=\"left\"> * 获取$_SERVER[\'REQUEST_URI\']中去除“QUERY_STRING”和前面“/”后的部分</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;URL为<a href=\"http://127.0.0.1/shell.linenet?hehe.nima&amp;m=n!abc#a\" target=\"_blank\">http://127.0.0.1/shell.linenet?hehe.nima&amp;m=n!abc#a</a>，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则URI为/shell.linenet?hehe.nima&amp;m=n!abc，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;处理后得到shell.linenet</div><div align=\"left\"> */</div><div align=\"left\">function uri_prefix(){</div><div align=\"left\">&nbsp; &nbsp; $uri = $_SERVER[\'REQUEST_URI\'];</div><div align=\"left\">&nbsp; &nbsp; $path_prefix = path_prefix();</div><div align=\"left\">&nbsp; &nbsp; $len = false === ($len = strpos($uri, \'?\')) ? strlen($uri) : $len;</div><div align=\"left\">&nbsp; &nbsp; $pre = strval(substr($uri, 1, $len - 1));</div><div align=\"left\">&nbsp; &nbsp; return $pre;</div><div align=\"left\">} </div><div align=\"left\">/**</div><div align=\"left\"> * 在uri_prefix()基础上，去除真实目录路径部分（当index.php不位于文档根目录时才需要用）</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;URL为<a href=\"http://127.0.0.1/pub/danmu/shell.linenet?hehe.nima&amp;m=n!abc#a\" target=\"_blank\">http://127.0.0.1/pub/danmu/shell.linenet?hehe.nima&amp;m=n!abc#a</a>，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则URI为/shell.linenet?hehe.nima&amp;m=n!abc，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;处理后得到shell.linenet</div><div align=\"left\"> * 注意：该方法要配合.htaccess文件使用才有效。</div><div align=\"left\"> * 具体如下：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;假定服务器文档根目录为/usr/www/</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;文件index.php为启动脚本，放置在虚拟相对于/usr/www/的虚拟目录pub/danmu/之下，可以视为/usr/www/pub/danmu/index.php</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;在虚拟目录中，pub/danmu/.htaccess文件的RewriteRule需要作特殊处理：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &lt;IfModule mod_rewrite.c&gt;</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteEngine on</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteBase /</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteCond %{REQUEST_FILENAME} !-f</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteCond %{REQUEST_FILENAME} !-d</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteRule . pub/danmu/index.php</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &lt;/IfModule&gt;</div><div align=\"left\"> */</div><div align=\"left\">function uri_pure(){</div><div align=\"left\">&nbsp; &nbsp; $uri = $_SERVER[\'REQUEST_URI\'];</div><div align=\"left\">&nbsp; &nbsp; $start = strlen(path_prefix());</div><div align=\"left\">&nbsp; &nbsp; $len = false === ($len = strpos($uri, \'?\')) ? strlen($uri) : $len;</div><div align=\"left\">&nbsp; &nbsp; $pure = strval(substr($uri, $start, $len - $start));</div><div align=\"left\">&nbsp; &nbsp; return $pure;</div><div align=\"left\">}</div><div align=\"left\">//在array_unshift的基础上，对插入首部的元素带上自定义key</div><div align=\"left\">function array_unshift_withkey(&amp;$arr, $key, $value){</div><div align=\"left\">&nbsp; &nbsp; $backup = $arr;</div><div align=\"left\">&nbsp; &nbsp; $arr = array($key =&gt; $value);</div><div align=\"left\">&nbsp; &nbsp; foreach ($backup as $k =&gt; $v) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if ($k == $key) continue;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$arr[$k] = $v;</div><div align=\"left\">&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp; return count($arr);</div><div align=\"left\">} </div><br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"><font color=\"#1e347b\"><font color=\"#bebec5\"><font color=\"#93a1a1\">//是否为单个字母</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_letter</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(</font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!=</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; $o </font><font color=\"#93a1a1\">=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'A\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'Z\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">||</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'a\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'z\'</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否为单个数字</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_a_num</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(</font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!=</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> is_numeric</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> </font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">==</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否形似变量</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_var</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!!</font><font color=\"#48484c\"> preg_match</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'/^[a-z_](?:[a-z][a-z0-9_]*)*/is\'</font><font color=\"#93a1a1\">,</font><font color=\"#48484c\"> $s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否全为字母</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_word</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">foreach</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">((</font><font color=\"#48484c\">array</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> $s </font><font color=\"#1e347b\">as</font><font color=\"#48484c\"> $ss</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">{</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(!</font><font color=\"#48484c\"> is_letter</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$ss</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#93a1a1\">}</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">true</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<font color=\"#93a1a1\"><br>\r\n</font><br>\r\n</font><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<div align=\"left\">/**</div><div align=\"left\"> * 调用对象的方法</div><div align=\"left\"> * @param object$obj 对象句柄</div><div align=\"left\"> * @param string$method 方法名</div><div align=\"left\"> * @param array$args 参数数组</div><div align=\"left\"> */</div><div align=\"left\">function invoke_method($obj, $method, $args=array()){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; if(! is_object($obj)){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(\"{$obj}对象不存在或非对象类型\");</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; if( method_exists($obj, $method) ){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return call_user_func_array(array($obj, $method), $args);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; else if(array_key_exists($method, get_object_vars($obj))){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if(is_callable(array($obj, $method))){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;call_user_func_array(array($obj, $method), $args);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}else{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(\'成员方法访问操作：\' . get_class($obj) . \' -&gt; \' . $method . \'成员变量不具备callable特性，不能调用&lt;br&gt;\');</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; else{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//如果成员不存在</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(get_class($obj) . \"对象的方法名[ {$method} ]不存在\");</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">}</div><br>\r\n<br>\r\n<div align=\"left\">执行入口：</div><br>\r\n<div align=\"left\">DI_ROUTE_REWRITE &amp;&amp; invoke_method($r = <strong>new </strong>DIRouteRewrite, \'rewrite\');&nbsp;&nbsp;</div><br>\r\n<br>\r\n<br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<font size=\"2\">本文转载须经作者{折木}同意&lt; <font color=\"#336699\"><u>http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;page=1&amp;extra=#pid24752</u></font> &gt;</font><font size=\"1\"><font color=\"#c0c0c0\">(别看汉字没写多少，【【注释不是吗~~)</font></font><img src=\"http://www.kusha.biz/static/image/smiley/pansite/PST_119.gif\" smilieid=\"105\" border=\"0\" alt=\"\"><font size=\"1\"><font color=\"#c0c0c0\"> </font></font><br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"> </font><br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"><br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n</font><br>\r\n<br>\r\n</td></tr></tbody></table>\r\n</div>\r\n<div id=\"comment_24752\" class=\"cm\">\r\n</div>\r\n<div id=\"post_rate_div_24752\"></div>\r\n</div></div>\r\n\r\n</td>', '<td class=\"plc\">\r\n<div class=\"pi\">\r\n<div id=\"fj\" class=\"y\">\r\n<label class=\"z\">电梯直达</label>\r\n<input type=\"text\" class=\"px p_fre z\" size=\"2\" onkeyup=\"$(\'fj_btn\').href=\'forum.php?mod=redirect&amp;ptid=3618&amp;authorid=0&amp;postno=\'+this.value\" onkeydown=\"if(event.keyCode==13) {window.location=$(\'fj_btn\').href;return false;}\" title=\"跳转到指定楼层\">\r\n<a href=\"javascript:;\" id=\"fj_btn\" class=\"z\" title=\"跳转到指定楼层\"><img src=\"http://www.kusha.biz/static/image/common/fj_btn.png\" alt=\"跳转到指定楼层\" class=\"vm\"></a>\r\n</div>\r\n<strong>\r\n<a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;fromuid=20\" title=\"您的朋友访问此链接后，您将获得相应的积分奖励\" id=\"postnum24752\" onclick=\"setCopy(this.href, \'帖子地址复制成功\');return false;\">楼主</a>\r\n</strong>\r\n<div class=\"pti\">\r\n<div class=\"pdbt\">\r\n</div>\r\n<div class=\"authi\">\r\n<img class=\"authicn vm\" id=\"authicon24752\" src=\"http://www.kusha.biz/static/image/common/online_admin.gif\">\r\n<em id=\"authorposton24752\">发表于 2015-4-1 01:50:16</em>\r\n<span class=\"pipe\">|</span><a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;page=1&amp;authorid=20\" rel=\"nofollow\">只看该作者</a>\r\n<span class=\"pipe\">|</span><a href=\"http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;extra=page%3D1&amp;ordertype=1\">倒序浏览</a>\r\n<span class=\"pipe\">|</span>\r\n<a id=\"replynotice\" href=\"http://www.kusha.biz/forum.php?mod=misc&amp;action=replynotice&amp;op=ignore&amp;tid=3618\" status=\"1\" onclick=\"ajaxmenu(this, 3000, 0, 0, \'43\', function () {replyNotice();});return false;\">取消回复通知</a>\r\n</div>\r\n</div>\r\n</div><div class=\"pct\"><style type=\"text/css\">.pcb{margin-right:0}</style><div class=\"pcb\">\r\n<div class=\"t_fsz\">\r\n<table cellspacing=\"0\" cellpadding=\"0\"><tbody><tr><td class=\"t_f\" id=\"postmessage_24752\">\r\n<img id=\"aimg_I9Z7e\" onclick=\"zoom(this, this.src, 0, 0, 0)\" class=\"zoom\" src=\"http://i2.tietuku.com/c1b94d510569e268.jpg\" onmouseover=\"img_onmouseoverfunc(this)\" onload=\"thumbImg(this)\" border=\"0\" alt=\"\" width=\"760\" height=\"427\" style=\"cursor: pointer;\" initialized=\"true\"><br>\r\n<br>\r\n<font size=\"7\">楼顶喂鱼~~~</font><br>\r\n<br>\r\n<br>\r\n<br>\r\n<div align=\"left\">define(\'DI_ROUTE_REWRITE\', <strong>true</strong>); //启用路由重写</div><div align=\"left\">define(\'DI_KILL_ON_FAIL_REWRITE\', <strong>true</strong>);&nbsp;&nbsp;//未匹配重写时，是否终止程序</div><br>\r\n<div align=\"left\"><strong>class </strong>DIRouteRewrite {</div><br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 自定义路由重写规则</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 书写原则，特殊在前，通用在后</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 详见：</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*&nbsp; &nbsp;&nbsp; &nbsp;DIRoute::rewrite() @ __route.php</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>static </strong><i>$rulesMap</i> = <strong>array</strong>(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'://danmucopy.me/t\' =&gt; \'test/test\', //含有域名的配置最好放在最前面(经验之谈)</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'://danmu.me/t\' =&gt; \'test/session\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'fm\' =&gt; \'fm/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about.htm\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'about.html\' =&gt; \'about\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'s\' =&gt; \'shell.shell\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'s.html\' =&gt; \'shell.shell\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;nums&gt;\' =&gt; \'test/start/&lt;nums&gt;\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;\' =&gt; \'&lt;D&gt;/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.htm\' =&gt; \'&lt;D&gt;/start\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.html\' =&gt; \'&lt;D&gt;/start\',</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;/&lt;F&gt;\' =&gt; \'&lt;D&gt;/&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;-&lt;F&gt;\' =&gt; \'&lt;D&gt;/&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'&lt;D&gt;.&lt;F&gt;\' =&gt; \'&lt;D&gt;.&lt;F&gt;\',</div><div align=\"left\">&nbsp; &nbsp; );</div><br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 不需要重写的</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 左侧为相对于脚本目录的URI</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 右侧表示重写失败时是否终止程序</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 这些规则不受常量DI_KILL_ON_FAIL_REWRITE影响</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>static </strong><i>$withoutMap</i> = <strong>array</strong>(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.php\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.html\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'index.htm\' =&gt; <strong>false</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'favicon.ico\' =&gt; <strong>true</strong>,</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;\'robots.txt\' =&gt; <strong>true</strong>,</div><div align=\"left\">&nbsp; &nbsp; );</div><br>\r\n<br>\r\n<div align=\"left\">&nbsp; &nbsp; /**</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 根据自定义规则重写路由。</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 不是所有规则都一定能实现，要看优先级。优先级以数组头部元素为最高</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* “&lt;&gt;”使用单个字母的，表示位置的代号，可实现规则的左右侧关系</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* &lt;num&gt;表示参数值为单数字，&lt;nums&gt;表示参数值为多个数字，&lt;letter&gt;表示参数值为单个字母，&lt;word&gt;表示参数值为多个字母，&lt;var&gt;表示参数值形似变量</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* 当不确定需要使用多少参数时，可以考虑使用尾随参数&lt;*&gt;</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;* &lt;*&gt;表示尾随参数，值类型任意，从左向右自动追加到规则右侧的尾部。追加尾随参数时，右侧用什么分隔符，就使用什么分隔符来分割参数。</div><div align=\"left\">&nbsp; &nbsp;&nbsp;&nbsp;*/</div><div align=\"left\">&nbsp; &nbsp; <strong>private function </strong>rewrite(){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$pureUri = \'/\' == path_prefix() ? uri_prefix() : uri_pure();</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(\'\' === $pureUri) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>return</strong>;//请求中没有有用的URI</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$rules = DIRouteRewrite::<i>$rulesMap</i>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$dontRules = DIRouteRewrite::<i>$withoutMap</i>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$req = url_prefix(\'://\') . $pureUri;</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//以下情况免重写</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(in_array($pureUri, array_keys($dontRules))) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>($dontRules[$pureUri]) <strong>die</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>return</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//开始尝试重写，遇到第一个符合的即确定结果</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>foreach </strong>($rules <strong>as </strong>$k =&gt; $rule) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$kBackup = $k;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>(0 !== stripos($k, \'://\')) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $k = \'://\' . $_SERVER[\'HTTP_HOST\'] . rtrim(dirname($_SERVER[\'SCRIPT_NAME\']), \'\\//\') . \'/\' . $k;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$k = \'/\' . str_ireplace(</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>array</strong>(\'\\\\\\\\\', \'://\', \'/\', \'&lt;\', \'&gt;\',&nbsp;&nbsp;\'.\', \'*\'),</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>array</strong>( \'\', \'\', \'\\/\', \'(?&lt;\', \'&gt;\\w+)?\', \'\\.\', \'tailparam\'),</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $k</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;) . \'\\/?$/i\';</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>if </strong>(preg_match($k, $req, $matchs)) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; $checkTypeInNeed = <strong>true</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>foreach</strong>($matchs <strong>as </strong>$matchkey =&gt; $matchval){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$isPosTag = is_letter($matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsLetter = 0 === strcasecmp(\'letter\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsLetter = is_letter($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsWord = 0 === strcasecmp(\'word\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsWord = is_word($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsNum = 0 === strcasecmp(\'num\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsNum = is_a_num($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsNums = 0 === strcasecmp(\'nums\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsNums = is_numeric($matchval);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$keyIsVar = 0 === strcasecmp(\'var\', $matchkey);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$valueIsVar = is_var($matchval);</div><br>\r\n<div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$typeIsNormal = $keyIsLetter &amp;&amp; $valueIsLetter || $keyIsWord &amp;&amp; $valueIsWord || $keyIsNum &amp;&amp; $valueIsNum || $keyIsNums &amp;&amp; $valueIsNums || $keyIsVar &amp;&amp; $valueIsVar;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>($isPosTag || $typeIsNormal) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$rule = str_ireplace(\"&lt;{$matchkey}&gt;\", $matchval, $rule);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;} <strong>elseif </strong>(\'tailparam\' === $matchkey) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$isDo = count(explode(\'/\', $rule)) &gt;= 2;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$delimiter = $isDo ? \'/\' : \'.\';</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$rule .= $delimiter . $matchval;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//检查需要匹配类型时，是否匹配成功</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>($keyIsLetter&amp;&amp;!$valueIsLetter || $keyIsWord&amp;&amp;!$valueIsWord || $keyIsNum&amp;&amp;!$valueIsNum || $keyIsNums&amp;&amp;!$valueIsNums || $keyIsVar&amp;&amp;!$valueIsVar) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;$checkTypeInNeed = <strong>false</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //通过$_SERVER[\'REQUEST_URI\']的关键信息，以及上述规则，来重写$GLOBALS[\'request_args\']的首索引，达到重写路由的目的</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //转化关系：a-b =&gt; a/b, a.b =&gt; a_b</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //使用a-b代替a/b，可以确保前端资源URL的正确性</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; //a_b的下划线“_”与URL中QUERY_STRING参数名保持一致写法，在进入route()后，会自动转化为“.”</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <strong>if </strong>($checkTypeInNeed) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$rule = str_replace(<strong>array</strong>(\'-\', \'.\'), <strong>array</strong>(\'/\', \'_\'), $rule);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;array_unshift_withkey($_REQUEST, $rule, \'\');</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>return</strong>; //到此处为重写成功</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }<strong>else </strong>{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$kBackup = str_ireplace(<strong>array</strong>(\'&lt;\',\'&gt;\'), <strong>array</strong>(\'＜\', \'＞\'), $kBackup);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$msg = \"已匹配到重写规则，但URI中的个别部分或参数不与规则中的设定匹配。当前规则：[{$kBackup} =&gt; {$rule}]\";</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>throw new </strong>Exception($msg);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//此处为无任何匹配时的处理。启用DI_KILL_ON_FAIL_REWRITE可以减少被盲点爬虫时消耗的流量</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<strong>if </strong>(DI_KILL_ON_FAIL_REWRITE) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<strong>die</strong>;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp; }&nbsp;&nbsp;</div><br>\r\n<br>\r\n<div align=\"left\">}&nbsp;&nbsp;</div><br>\r\n<br>\r\n<div align=\"left\"><font color=\"black\"><font face=\"&amp;quot;\"><font style=\"font-size:24.0pt\">以下是相关的辅助函数：</font></font></font></div><br>\r\n<div align=\"left\">/**</div><div align=\"left\"> * 获取当前执行的WEB目录前缀，截至当前执行目录，头部和尾部有“/”</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;WEB根目录是 /usr/www/，要执行的脚本文件所在路径为/usr/www/aaa/index.php，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则该脚本所在目录相对WEB根目录的路径值为：/aaa/，该值可由此方法得到。</div><div align=\"left\"> */</div><div align=\"left\">function path_prefix(){</div><div align=\"left\">&nbsp; &nbsp; $di_sn = $_SERVER[\'SCRIPT_NAME\'];</div><div align=\"left\">&nbsp; &nbsp; $di_num = strrpos($di_sn, \'/\');</div><div align=\"left\">&nbsp; &nbsp; $di_ppr = substr($di_sn, 1, $di_num);//所在目录的相对路径，如“danmu/”</div><div align=\"left\">&nbsp; &nbsp; return \"/{$di_ppr}\";</div><div align=\"left\">}</div><div align=\"left\">/**</div><div align=\"left\"> * 获取$_SERVER[\'REQUEST_URI\']中去除“QUERY_STRING”和前面“/”后的部分</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;URL为<a href=\"http://127.0.0.1/shell.linenet?hehe.nima&amp;m=n!abc#a\" target=\"_blank\">http://127.0.0.1/shell.linenet?hehe.nima&amp;m=n!abc#a</a>，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则URI为/shell.linenet?hehe.nima&amp;m=n!abc，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;处理后得到shell.linenet</div><div align=\"left\"> */</div><div align=\"left\">function uri_prefix(){</div><div align=\"left\">&nbsp; &nbsp; $uri = $_SERVER[\'REQUEST_URI\'];</div><div align=\"left\">&nbsp; &nbsp; $path_prefix = path_prefix();</div><div align=\"left\">&nbsp; &nbsp; $len = false === ($len = strpos($uri, \'?\')) ? strlen($uri) : $len;</div><div align=\"left\">&nbsp; &nbsp; $pre = strval(substr($uri, 1, $len - 1));</div><div align=\"left\">&nbsp; &nbsp; return $pre;</div><div align=\"left\">} </div><div align=\"left\">/**</div><div align=\"left\"> * 在uri_prefix()基础上，去除真实目录路径部分（当index.php不位于文档根目录时才需要用）</div><div align=\"left\"> * 例如：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;URL为<a href=\"http://127.0.0.1/pub/danmu/shell.linenet?hehe.nima&amp;m=n!abc#a\" target=\"_blank\">http://127.0.0.1/pub/danmu/shell.linenet?hehe.nima&amp;m=n!abc#a</a>，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;则URI为/shell.linenet?hehe.nima&amp;m=n!abc，</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;处理后得到shell.linenet</div><div align=\"left\"> * 注意：该方法要配合.htaccess文件使用才有效。</div><div align=\"left\"> * 具体如下：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;假定服务器文档根目录为/usr/www/</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;文件index.php为启动脚本，放置在虚拟相对于/usr/www/的虚拟目录pub/danmu/之下，可以视为/usr/www/pub/danmu/index.php</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;在虚拟目录中，pub/danmu/.htaccess文件的RewriteRule需要作特殊处理：</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &lt;IfModule mod_rewrite.c&gt;</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteEngine on</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteBase /</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteCond %{REQUEST_FILENAME} !-f</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteCond %{REQUEST_FILENAME} !-d</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; RewriteRule . pub/danmu/index.php</div><div align=\"left\"> *&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &lt;/IfModule&gt;</div><div align=\"left\"> */</div><div align=\"left\">function uri_pure(){</div><div align=\"left\">&nbsp; &nbsp; $uri = $_SERVER[\'REQUEST_URI\'];</div><div align=\"left\">&nbsp; &nbsp; $start = strlen(path_prefix());</div><div align=\"left\">&nbsp; &nbsp; $len = false === ($len = strpos($uri, \'?\')) ? strlen($uri) : $len;</div><div align=\"left\">&nbsp; &nbsp; $pure = strval(substr($uri, $start, $len - $start));</div><div align=\"left\">&nbsp; &nbsp; return $pure;</div><div align=\"left\">}</div><div align=\"left\">//在array_unshift的基础上，对插入首部的元素带上自定义key</div><div align=\"left\">function array_unshift_withkey(&amp;$arr, $key, $value){</div><div align=\"left\">&nbsp; &nbsp; $backup = $arr;</div><div align=\"left\">&nbsp; &nbsp; $arr = array($key =&gt; $value);</div><div align=\"left\">&nbsp; &nbsp; foreach ($backup as $k =&gt; $v) {</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if ($k == $key) continue;</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;$arr[$k] = $v;</div><div align=\"left\">&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp; return count($arr);</div><div align=\"left\">} </div><br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"><font color=\"#1e347b\"><font color=\"#bebec5\"><font color=\"#93a1a1\">//是否为单个字母</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_letter</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(</font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!=</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; $o </font><font color=\"#93a1a1\">=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'A\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'Z\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">||</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'a\'</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> $o </font><font color=\"#93a1a1\">&lt;=</font><font color=\"#48484c\"> ord</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'z\'</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否为单个数字</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_a_num</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(</font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!=</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> is_numeric</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">&amp;&amp;</font><font color=\"#48484c\"> </font><font color=\"#195f91\">1</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">==</font><font color=\"#48484c\"> strlen</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否形似变量</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_var</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">!!</font><font color=\"#48484c\"> preg_match</font><font color=\"#93a1a1\">(</font><font color=\"#dd1144\">\'/^[a-z_](?:[a-z][a-z0-9_]*)*/is\'</font><font color=\"#93a1a1\">,</font><font color=\"#48484c\"> $s</font><font color=\"#93a1a1\">);</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">//是否全为字母</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#1e347b\">function</font><font color=\"#48484c\"> is_word</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$s</font><font color=\"#93a1a1\">){</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">foreach</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">((</font><font color=\"#48484c\">array</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> $s </font><font color=\"#1e347b\">as</font><font color=\"#48484c\"> $ss</font><font color=\"#93a1a1\">)</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">{</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</font><font color=\"#1e347b\">if</font><font color=\"#48484c\"> </font><font color=\"#93a1a1\">(!</font><font color=\"#48484c\"> is_letter</font><font color=\"#93a1a1\">(</font><font color=\"#48484c\">$ss</font><font color=\"#93a1a1\">))</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">false</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#93a1a1\">}</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#48484c\">&nbsp; &nbsp; </font><font color=\"#1e347b\">return</font><font color=\"#48484c\"> </font><font color=\"#1e347b\">true</font><font color=\"#93a1a1\">;</font></font><br>\r\n<font color=\"#bebec5\"><font color=\"#93a1a1\">}</font></font><br>\r\n<font color=\"#93a1a1\"><br>\r\n</font><br>\r\n</font><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<div align=\"left\">/**</div><div align=\"left\"> * 调用对象的方法</div><div align=\"left\"> * @param object$obj 对象句柄</div><div align=\"left\"> * @param string$method 方法名</div><div align=\"left\"> * @param array$args 参数数组</div><div align=\"left\"> */</div><div align=\"left\">function invoke_method($obj, $method, $args=array()){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; if(! is_object($obj)){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(\"{$obj}对象不存在或非对象类型\");</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; if( method_exists($obj, $method) ){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return call_user_func_array(array($obj, $method), $args);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; else if(array_key_exists($method, get_object_vars($obj))){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if(is_callable(array($obj, $method))){</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;call_user_func_array(array($obj, $method), $args);</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}else{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(\'成员方法访问操作：\' . get_class($obj) . \' -&gt; \' . $method . \'成员变量不具备callable特性，不能调用&lt;br&gt;\');</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; else{</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;//如果成员不存在</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;throw new DIException(get_class($obj) . \"对象的方法名[ {$method} ]不存在\");</div><div align=\"left\">&nbsp; &nbsp;&nbsp; &nbsp; }</div><div align=\"left\">}</div><br>\r\n<br>\r\n<div align=\"left\">执行入口：</div><br>\r\n<div align=\"left\">DI_ROUTE_REWRITE &amp;&amp; invoke_method($r = <strong>new </strong>DIRouteRewrite, \'rewrite\');&nbsp;&nbsp;</div><br>\r\n<br>\r\n<br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<font size=\"2\">本文转载须经作者{折木}同意&lt; <font color=\"#336699\"><u>http://www.kusha.biz/forum.php?mod=viewthread&amp;tid=3618&amp;page=1&amp;extra=#pid24752</u></font> &gt;</font><font size=\"1\"><font color=\"#c0c0c0\">(别看汉字没写多少，【【注释不是吗~~)</font></font><img src=\"http://www.kusha.biz/static/image/smiley/pansite/PST_119.gif\" smilieid=\"105\" border=\"0\" alt=\"\"><font size=\"1\"><font color=\"#c0c0c0\"> </font></font><br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"> </font><br>\r\n<font color=\"#1e347b\"><br>\r\n</font><br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<font color=\"#000\"><br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n<br>\r\n</font><br>\r\n<br>\r\n</td></tr></tbody></table>\r\n</div>\r\n<div id=\"comment_24752\" class=\"cm\">\r\n</div>\r\n<div id=\"post_rate_div_24752\"></div>\r\n</div></div>\r\n\r\n</td>', '1429639311', '1429639311', '1', '', '99');
INSERT INTO `lr_posts` VALUES ('19', 'sdfds', '\n<p>fdsfdsfd</p>\n', '<p>fdsfdsfd</p>\r\n', '1429639704', '1429639740', '3', '', '127');
INSERT INTO `lr_posts` VALUES ('20', '现在的ACG资源名称真是又臭又长', '[Vmoe字幕组][Symphogear Live 2013][シンフォギアライブ2013][战姬绝唱LIVE 2013][BDrip][1080P 10bit][中日特效字幕]\r\n\r\n像这个，字幕组、英文番号、日文番号、中文番号、压制类型、压制程度、字幕类型等等。。\r\n\r\n这种类型的资源太多，文件系统扛得住么  <img src=\"./res/biz/other/jinguanyu.gif\">\r\n\r\n', '[Vmoe字幕组][Symphogear Live 2013][シンフォギアライブ2013][战姬绝唱LIVE 2013][BDrip][1080P 10bit][中日特效字幕]\r\n\r\n像这个，字幕组、英文番号、日文番号、中文番号、压制类型、压制程度、字幕类型等等。。\r\n\r\n这种类型的资源太多，文件系统扛得住么  <img src=\"./res/biz/other/jinguanyu.gif\">\r\n\r\n', '1429667080', '1429667080', '1', 'chou', '6');
INSERT INTO `lr_posts` VALUES ('21', '模块化表单验证的写法（不解释代码，只看风格）', '<code>\r\n<pre>\r\nseajs.use([\'gallery/jquery/1.11.1/jquery\', \'gallery/underscore/1.6.0/underscore\'], function($, _){\r\n\r\n    \r\n    var personCols = [\'real_name\', \'sex\', \'phone\', \'email\', \'apply_intro\', \'id_card\', \'id_card_img\', \'extra_img\'];\r\n    var teamCols = [\'approve_name\', \'apply_intro\', \'real_name\', \'sex\', \'job\', \'phone\', \'email\', \'id_card\', \'id_card_img\', \'extra_img\'];\r\n    \r\n    \r\n    function checkOneData(col, val, elem){\r\n        var check = true;\r\n        if (! checkCols(col, val)) {\r\n            check = false;\r\n            errHandler(col, val, elem);\r\n        } else {\r\n            rightHandler(col, val, elem);\r\n        }\r\nconsole.log(\'checkOneData::\'+col+\' * \'+val, check);//test\r\n        return check;\r\n    }\r\n    \r\n    \r\n    function checkDatas(classPre, apply_type){\r\n        var cols = 2 == apply_type ? personCols : teamCols;\r\n        var data = {apply_type : apply_type};\r\n        var check = true;\r\n        for (var i in cols) {\r\n            var col = cols[i];\r\n            var elem = $(classPre + col + \':first\');\r\n            var val = elem.val();\r\n            console.log(cols[i], val);\r\n            data[col] = elem.val();\r\nconsole.log(\'check col \'+col+\' : \', checkCols(col, val));//test\r\n            checkOneData(col, val, elem) || (check = false);\r\n        }\r\n        return check && data;\r\n    }\r\n    \r\n    \r\n    function submitData(classPre, apply_type) {\r\n        var data = checkDatas(classPre, apply_type);\r\n        console.log([\'checkData result is : \', data]);\r\n        return false;\r\n        if (false !== data) {\r\n            $.post(location.hostname + \'/podcast/ToApply\', data, function(j){\r\n                console.log(j);\r\n            }, \'json\');\r\n        }\r\n    }\r\n    \r\n    \r\n    function checkCols(col, val){\r\n        if (\'apply_type\' == col) return true;\r\n        var rules = {\r\n            \'approve_name\' : !! val,\r\n            \'real_name\' : !! val,\r\n            \'sex\' : _.indexOf([0,1], parseInt(val)) != -1,\r\n            \'phone\' : /^1[3578]\\d{9}$/.test(val),\r\n            \'email\' : /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(val),\r\n            \'job\' : !! val || true, //职务暂时不限制\r\n            \'intro\' : !! val,\r\n            \'apply_intro\' : !! val,\r\n            \'members\' : /^\\d{1,8}$/.test(val),\r\n            \'id_card\' : /^[1-9]([0-9]{16}|[0-9]{13})[xX0-9]$/.test(val),\r\n            \'id_card_img\' : /((http|https):\\/\\/)?([a-z0-9_\\-\\/\\.]+\\.[a-z0-9:;&#@=_~%\\?\\/\\.\\,\\+\\-]+)/.test(val),\r\n            \'extra_img\' : /((http|https):\\/\\/)?([a-z0-9_\\-\\/\\.]+\\.[a-z0-9:;&#@=_~%\\?\\/\\.\\,\\+\\-]+)/.test(val)\r\n        };\r\n        return rules[col];\r\n    }\r\n    \r\n    \r\n    function errHandler(col, val, elem){\r\n        if (-1 == _.indexOf(personCols, col) && -1 == _.indexOf(teamCols, col)) return false;\r\n        var handlers = {\r\n            \'approve_name\' : function(val, elem){\r\n                console.log(1);\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'real_name\' : function(val, elem){\r\n                console.log(2)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'sex\' : function(val, elem){\r\n                console.log(3)\r\n            },\r\n            \'phone\' : function(val, elem){\r\n                console.log(4)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'email\' : function(val, elem){\r\n                console.log(5)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'job\' : function(val, elem){\r\n                console.log(6)\r\n            },\r\n            \'intro\' : function(val, elem){\r\n                console.log(7)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'apply_intro\' : function(val, elem){\r\n                console.log(8)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'members\' : function(val, elem){\r\n                console.log(9)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'id_card\' : function(val, elem){\r\n                console.log(10)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'id_card_img\' : function(val, elem){\r\n                console.log(11)\r\n            },\r\n            \'extra_img\' : function(val, elem){\r\n                console.log(12)\r\n            }\r\n        };\r\n        handlers[col](val, elem);\r\n    }\r\n    \r\n    \r\n    function rightHandler(col, val, elem) {\r\n        if (-1 == _.indexOf(personCols, col) && -1 == _.indexOf(teamCols, col)) return false;\r\n        var handlers = {\r\n            \'approve_name\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'real_name\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'sex\' : function(val, elem){\r\n            },\r\n            \'phone\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'email\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'job\' : function(val, elem){\r\n            },\r\n            \'intro\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'apply_intro\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'members\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'id_card\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'id_card_img\' : function(val, elem){\r\n            },\r\n            \'extra_img\' : function(val, elem){\r\n            }\r\n        };\r\n        handlers[col](val, elem);\r\n    }\r\n    \r\n    \r\n    function bindBlurCols(){\r\n        var items = [personCols, teamCols];\r\n        var pres = [\'.diy-data-person-\', \'.diy-data-team-\'];\r\n        for (var i in items) {\r\n            for (var j in items[i]) {\r\n                var col = items[i][j];\r\n                var elem = $(pres[i] + col + \':first\');\r\n                elem.data(\'col\', col);\r\n                elem.blur(function(){\r\n                    var col = $(this).data(\'col\');\r\n                    var val = $(this).val();\r\n                    checkOneData(col, val, $(this));\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    \r\n    function bindSubmit(){\r\n        $(\'#diy-person-submit\').click(function(){ submitData(\'.diy-data-person-\', 2); });\r\n        $(\'#diy-team-submit\').click(function(){ submitData(\'.diy-data-team-\', 3); });\r\n    }\r\n    \r\n    \r\n    ! function init(){\r\n        bindBlurCols();\r\n        bindSubmit();\r\n    }();\r\n    \r\n\r\n});\r\n</pre>\r\n</code>', '<code>\r\n<pre>\r\nseajs.use([\'gallery/jquery/1.11.1/jquery\', \'gallery/underscore/1.6.0/underscore\'], function($, _){\r\n\r\n    \r\n    var personCols = [\'real_name\', \'sex\', \'phone\', \'email\', \'apply_intro\', \'id_card\', \'id_card_img\', \'extra_img\'];\r\n    var teamCols = [\'approve_name\', \'apply_intro\', \'real_name\', \'sex\', \'job\', \'phone\', \'email\', \'id_card\', \'id_card_img\', \'extra_img\'];\r\n    \r\n    \r\n    function checkOneData(col, val, elem){\r\n        var check = true;\r\n        if (! checkCols(col, val)) {\r\n            check = false;\r\n            errHandler(col, val, elem);\r\n        } else {\r\n            rightHandler(col, val, elem);\r\n        }\r\nconsole.log(\'checkOneData::\'+col+\' * \'+val, check);//test\r\n        return check;\r\n    }\r\n    \r\n    \r\n    function checkDatas(classPre, apply_type){\r\n        var cols = 2 == apply_type ? personCols : teamCols;\r\n        var data = {apply_type : apply_type};\r\n        var check = true;\r\n        for (var i in cols) {\r\n            var col = cols[i];\r\n            var elem = $(classPre + col + \':first\');\r\n            var val = elem.val();\r\n            console.log(cols[i], val);\r\n            data[col] = elem.val();\r\nconsole.log(\'check col \'+col+\' : \', checkCols(col, val));//test\r\n            checkOneData(col, val, elem) || (check = false);\r\n        }\r\n        return check && data;\r\n    }\r\n    \r\n    \r\n    function submitData(classPre, apply_type) {\r\n        var data = checkDatas(classPre, apply_type);\r\n        console.log([\'checkData result is : \', data]);\r\n        return false;\r\n        if (false !== data) {\r\n            $.post(location.hostname + \'/podcast/ToApply\', data, function(j){\r\n                console.log(j);\r\n            }, \'json\');\r\n        }\r\n    }\r\n    \r\n    \r\n    function checkCols(col, val){\r\n        if (\'apply_type\' == col) return true;\r\n        var rules = {\r\n            \'approve_name\' : !! val,\r\n            \'real_name\' : !! val,\r\n            \'sex\' : _.indexOf([0,1], parseInt(val)) != -1,\r\n            \'phone\' : /^1[3578]\\d{9}$/.test(val),\r\n            \'email\' : /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(val),\r\n            \'job\' : !! val || true, //职务暂时不限制\r\n            \'intro\' : !! val,\r\n            \'apply_intro\' : !! val,\r\n            \'members\' : /^\\d{1,8}$/.test(val),\r\n            \'id_card\' : /^[1-9]([0-9]{16}|[0-9]{13})[xX0-9]$/.test(val),\r\n            \'id_card_img\' : /((http|https):\\/\\/)?([a-z0-9_\\-\\/\\.]+\\.[a-z0-9:;&#@=_~%\\?\\/\\.\\,\\+\\-]+)/.test(val),\r\n            \'extra_img\' : /((http|https):\\/\\/)?([a-z0-9_\\-\\/\\.]+\\.[a-z0-9:;&#@=_~%\\?\\/\\.\\,\\+\\-]+)/.test(val)\r\n        };\r\n        return rules[col];\r\n    }\r\n    \r\n    \r\n    function errHandler(col, val, elem){\r\n        if (-1 == _.indexOf(personCols, col) && -1 == _.indexOf(teamCols, col)) return false;\r\n        var handlers = {\r\n            \'approve_name\' : function(val, elem){\r\n                console.log(1);\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'real_name\' : function(val, elem){\r\n                console.log(2)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'sex\' : function(val, elem){\r\n                console.log(3)\r\n            },\r\n            \'phone\' : function(val, elem){\r\n                console.log(4)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'email\' : function(val, elem){\r\n                console.log(5)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'job\' : function(val, elem){\r\n                console.log(6)\r\n            },\r\n            \'intro\' : function(val, elem){\r\n                console.log(7)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'apply_intro\' : function(val, elem){\r\n                console.log(8)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'members\' : function(val, elem){\r\n                console.log(9)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'id_card\' : function(val, elem){\r\n                console.log(10)\r\n                elem.addClass(\'error_txt\').next(\'.error\').removeClass(\'hide\');\r\n            },\r\n            \'id_card_img\' : function(val, elem){\r\n                console.log(11)\r\n            },\r\n            \'extra_img\' : function(val, elem){\r\n                console.log(12)\r\n            }\r\n        };\r\n        handlers[col](val, elem);\r\n    }\r\n    \r\n    \r\n    function rightHandler(col, val, elem) {\r\n        if (-1 == _.indexOf(personCols, col) && -1 == _.indexOf(teamCols, col)) return false;\r\n        var handlers = {\r\n            \'approve_name\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'real_name\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'sex\' : function(val, elem){\r\n            },\r\n            \'phone\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'email\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'job\' : function(val, elem){\r\n            },\r\n            \'intro\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'apply_intro\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'members\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'id_card\' : function(val, elem){\r\n                elem.removeClass(\'error_txt\').next(\'.error\').addClass(\'hide\');\r\n            },\r\n            \'id_card_img\' : function(val, elem){\r\n            },\r\n            \'extra_img\' : function(val, elem){\r\n            }\r\n        };\r\n        handlers[col](val, elem);\r\n    }\r\n    \r\n    \r\n    function bindBlurCols(){\r\n        var items = [personCols, teamCols];\r\n        var pres = [\'.diy-data-person-\', \'.diy-data-team-\'];\r\n        for (var i in items) {\r\n            for (var j in items[i]) {\r\n                var col = items[i][j];\r\n                var elem = $(pres[i] + col + \':first\');\r\n                elem.data(\'col\', col);\r\n                elem.blur(function(){\r\n                    var col = $(this).data(\'col\');\r\n                    var val = $(this).val();\r\n                    checkOneData(col, val, $(this));\r\n                });\r\n            }\r\n        }\r\n    }\r\n    \r\n    \r\n    function bindSubmit(){\r\n        $(\'#diy-person-submit\').click(function(){ submitData(\'.diy-data-person-\', 2); });\r\n        $(\'#diy-team-submit\').click(function(){ submitData(\'.diy-data-team-\', 3); });\r\n    }\r\n    \r\n    \r\n    ! function init(){\r\n        bindBlurCols();\r\n        bindSubmit();\r\n    }();\r\n    \r\n\r\n});\r\n</pre>\r\n</code>', '1429719543', '1430275114', '1', '', '99');
INSERT INTO `lr_posts` VALUES ('22', '【ACG翻唱期榜】2015-04-26 收集', '<div id=\"posts-22-fc\">\r\n<pre>\r\n小缘 - 花は桜、君は美しい - 原唱いきものがかり\r\nhttp://5sing.kugou.com/fc/13401415.html\r\n\r\n凑诗 - 小夜子 (词：浓缩排骨) - 原唱初音ミク\r\nhttp://5sing.kugou.com/fc/11936645.html\r\n\r\n凑诗 - 占卜师 - 原唱查理cherry\r\nhttp://5sing.kugou.com/fc/14082339.html\r\n\r\n凑诗 - 文乃の心做し理论 原唱V家\r\nhttp://5sing.kugou.com/fc/13777052.html\r\n\r\n凑诗 - 蛍 - 原唱藤田麻衣子\r\nhttp://5sing.kugou.com/fc/13163073.html\r\n\r\n凑诗 - 福寿草 (solo.ver）- 原唱初音ミク\r\nhttp://5sing.kugou.com/fc/12934227.html\r\n\r\n祈Inory - RAP版自挂东南枝 - 原唱卢恒宇\r\nhttp://5sing.kugou.com/fc/9780865.html\r\n\r\n\r\n</pre>\r\n</div>\r\n\r\n<script>\r\n$(function(){\r\n    $(\'#posts-22-fc\').parent(\'.diy-posts-line-content\').unbind(\'click\');\r\n});\r\n</script>', '<div id=\"posts-22-fc\">\r\n<pre>\r\n小缘 - 花は桜、君は美しい - 原唱いきものがかり\r\nhttp://5sing.kugou.com/fc/13401415.html\r\n\r\n凑诗 - 小夜子 (词：浓缩排骨) - 原唱初音ミク\r\nhttp://5sing.kugou.com/fc/11936645.html\r\n\r\n凑诗 - 占卜师 - 原唱查理cherry\r\nhttp://5sing.kugou.com/fc/14082339.html\r\n\r\n凑诗 - 文乃の心做し理论 原唱V家\r\nhttp://5sing.kugou.com/fc/13777052.html\r\n\r\n凑诗 - 蛍 - 原唱藤田麻衣子\r\nhttp://5sing.kugou.com/fc/13163073.html\r\n\r\n凑诗 - 福寿草 (solo.ver）- 原唱初音ミク\r\nhttp://5sing.kugou.com/fc/12934227.html\r\n\r\n祈Inory - RAP版自挂东南枝 - 原唱卢恒宇\r\nhttp://5sing.kugou.com/fc/9780865.html\r\n\r\n\r\n</pre>\r\n</div>\r\n\r\n<script>\r\n$(function(){\r\n    $(\'#posts-22-fc\').parent(\'.diy-posts-line-content\').unbind(\'click\');\r\n});\r\n</script>', '1430064089', '1430064384', '1', '', '0');
INSERT INTO `lr_posts` VALUES ('23', '如何实现接口查询池', '<pre>\r\n问题背景： \r\n1、A表与B表原属同库，原程序仅需联表查询就可得到结果 \r\n2、B表迁移到其它库后，原程序需要调用B表的查询接口，并结合A表的数据，才能得到结果。 \r\n3、当需要结合B表全部数据进行查询时，B表对外接口已无法满足需求。\r\n\r\n目的： \r\n设计一种中间层，能够实现等同于以前同库联表查询的效果。\r\n</pre>', '<pre>\r\n问题背景： \r\n1、A表与B表原属同库，原程序仅需联表查询就可得到结果 \r\n2、B表迁移到其它库后，原程序需要调用B表的查询接口，并结合A表的数据，才能得到结果。 \r\n3、当需要结合B表全部数据进行查询时，B表对外接口已无法满足需求。\r\n\r\n目的： \r\n设计一种中间层，能够实现等同于以前同库联表查询的效果。\r\n</pre>', '1430275155', '1430275318', '1', '', '0');
INSERT INTO `lr_posts` VALUES ('24', '更大程度分离前后端的工作', '在模板输出方法tpl()中，把服务端模板引擎(如smarty)替换为对nodejs输出引擎的调用。\r\n\r\n从而将套模板的工作转移到前端人员，而后端人员则更专注于后端服务的开发，更大降低前后端的耦合度。', '在模板输出方法tpl()中，把服务端模板引擎(如smarty)替换为对nodejs输出引擎的调用。\r\n\r\n从而将套模板的工作转移到前端人员，而后端人员则更专注于后端服务的开发，更大降低前后端的耦合度。', '1431178628', '1431178887', '1', '', '0');
INSERT INTO `lr_posts` VALUES ('25', '兰州烧饼', '<pre>\r\n<code>\r\npackage 兰州烧饼;\r\nimport java.util.Random;\r\nclass 傻逼类型 extends Object{\r\n	boolean 是否傻逼;\r\n	public 傻逼类型(){\r\n		是否傻逼 = true;\r\n	}\r\n	public 傻逼类型(boolean 傻逼值){\r\n		this.是否傻逼 = 傻逼值;\r\n	}\r\n	public boolean get傻逼(){\r\n		return 是否傻逼;\r\n	}\r\n	public void set傻逼(boolean 傻逼值){\r\n		是否傻逼 = 傻逼值;\r\n	}\r\n}\r\ninterface 傻逼的把柄{\r\n	public String 傻逼行为 = \"默认傻逼行为\";\r\n	public String 傻逼言论  = \"我是傻逼\";\r\n	public boolean 是否有傻逼行为();\r\n	public boolean 是否有傻逼言论();\r\n}\r\npublic class 兰州烧饼 extends 傻逼类型 implements 傻逼的把柄{\r\n\r\n	public 兰州烧饼(){\r\n		super();\r\n	}\r\n	public 兰州烧饼(boolean 傻逼值){\r\n		super(傻逼值);\r\n	}\r\n	\r\n	public boolean 是否有傻逼行为() {\r\n		return new Random().nextBoolean();\r\n	}\r\n	\r\n	public boolean 是否有傻逼言论() {\r\n		return new Random().nextBoolean();\r\n	}\r\n	public boolean get傻逼(){\r\n		return 是否有傻逼行为()||是否有傻逼言论() ? true : false;\r\n	}\r\n	public String toString(){\r\n		String 结论一 = 是否有傻逼行为() ? \"有傻逼行为\\n\" : \"没有傻逼行为\";\r\n		String 结论二 = 是否有傻逼言论() ? \"有傻逼言论\\n\" : \"没有傻逼言论\";\r\n		String 结论三 = String.valueOf(get傻逼()) + \"\\n\";\r\n		return 结论一 + 结论二 + 结论三;\r\n	}\r\n	//测试楼主是不是傻逼\r\n	public static void main(String[] args){\r\n		兰州烧饼 楼主 = new 兰州烧饼(true);\r\n		System.out.println(楼主.toString());\r\n	}\r\n}\r\n</code>\r\n</pre>', '<pre>\r\n<code>\r\npackage 兰州烧饼;\r\nimport java.util.Random;\r\nclass 傻逼类型 extends Object{\r\n	boolean 是否傻逼;\r\n	public 傻逼类型(){\r\n		是否傻逼 = true;\r\n	}\r\n	public 傻逼类型(boolean 傻逼值){\r\n		this.是否傻逼 = 傻逼值;\r\n	}\r\n	public boolean get傻逼(){\r\n		return 是否傻逼;\r\n	}\r\n	public void set傻逼(boolean 傻逼值){\r\n		是否傻逼 = 傻逼值;\r\n	}\r\n}\r\ninterface 傻逼的把柄{\r\n	public String 傻逼行为 = \"默认傻逼行为\";\r\n	public String 傻逼言论  = \"我是傻逼\";\r\n	public boolean 是否有傻逼行为();\r\n	public boolean 是否有傻逼言论();\r\n}\r\npublic class 兰州烧饼 extends 傻逼类型 implements 傻逼的把柄{\r\n\r\n	public 兰州烧饼(){\r\n		super();\r\n	}\r\n	public 兰州烧饼(boolean 傻逼值){\r\n		super(傻逼值);\r\n	}\r\n	\r\n	public boolean 是否有傻逼行为() {\r\n		return new Random().nextBoolean();\r\n	}\r\n	\r\n	public boolean 是否有傻逼言论() {\r\n		return new Random().nextBoolean();\r\n	}\r\n	public boolean get傻逼(){\r\n		return 是否有傻逼行为()||是否有傻逼言论() ? true : false;\r\n	}\r\n	public String toString(){\r\n		String 结论一 = 是否有傻逼行为() ? \"有傻逼行为\\n\" : \"没有傻逼行为\";\r\n		String 结论二 = 是否有傻逼言论() ? \"有傻逼言论\\n\" : \"没有傻逼言论\";\r\n		String 结论三 = String.valueOf(get傻逼()) + \"\\n\";\r\n		return 结论一 + 结论二 + 结论三;\r\n	}\r\n	//测试楼主是不是傻逼\r\n	public static void main(String[] args){\r\n		兰州烧饼 楼主 = new 兰州烧饼(true);\r\n		System.out.println(楼主.toString());\r\n	}\r\n}\r\n</code>\r\n</pre>', '1431181144', '1431181144', '1', 'shaobing', '127');

-- ----------------------------
-- Table structure for `lr_remind`
-- ----------------------------
DROP TABLE IF EXISTS `lr_remind`;
CREATE TABLE `lr_remind` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(50) COLLATE utf8_unicode_ci DEFAULT NULL,
  `content` text COLLATE utf8_unicode_ci,
  `uid` int(10) unsigned DEFAULT NULL,
  `cretime` int(10) unsigned zerofill DEFAULT NULL COMMENT '系统创建提醒的时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Records of lr_remind
-- ----------------------------

-- ----------------------------
-- Table structure for `lr_reply`
-- ----------------------------
DROP TABLE IF EXISTS `lr_reply`;
CREATE TABLE `lr_reply` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `content` text COLLATE utf8_unicode_ci,
  `uid` int(10) unsigned DEFAULT NULL,
  `pid` int(10) unsigned DEFAULT NULL COMMENT '帖子id',
  `create_time` int(10) unsigned zerofill DEFAULT NULL,
  `update_time` int(10) unsigned zerofill DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- ----------------------------
-- Records of lr_reply
-- ----------------------------
INSERT INTO `lr_reply` VALUES ('1', '第一条评论', '1', '1', null, null);

-- ----------------------------
-- Table structure for `lr_rooter`
-- ----------------------------
DROP TABLE IF EXISTS `lr_rooter`;
CREATE TABLE `lr_rooter` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `passport` varchar(20) NOT NULL COMMENT '通行证',
  `first_ip` varchar(16) NOT NULL DEFAULT '',
  `last_ip` varchar(255) NOT NULL DEFAULT '',
  `first_time` int(10) unsigned NOT NULL DEFAULT '0',
  `last_time` int(10) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of lr_rooter
-- ----------------------------
INSERT INTO `lr_rooter` VALUES ('1', 'root', '', '', '0', '0');

-- ----------------------------
-- Table structure for `lr_topic`
-- ----------------------------
DROP TABLE IF EXISTS `lr_topic`;
CREATE TABLE `lr_topic` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `tname` varchar(30) NOT NULL COMMENT '专题名',
  `desc` varchar(512) NOT NULL COMMENT '描述',
  `uid` int(11) NOT NULL DEFAULT '0' COMMENT '创建人',
  `time` int(11) DEFAULT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of lr_topic
-- ----------------------------

-- ----------------------------
-- Table structure for `lr_user`
-- ----------------------------
DROP TABLE IF EXISTS `lr_user`;
CREATE TABLE `lr_user` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `passport` varchar(20) NOT NULL COMMENT '登录名',
  `nickname` varchar(20) NOT NULL COMMENT '显示昵称',
  `password` varchar(50) NOT NULL COMMENT '登录密码',
  `forum_name` varchar(20) DEFAULT NULL COMMENT '所属论坛名',
  `forum_section` varchar(20) DEFAULT NULL COMMENT '所属板块名',
  `forum_id` int(11) DEFAULT NULL COMMENT '所属论坛id',
  `forum_sectionid` varchar(10) DEFAULT NULL COMMENT '所属板块id，如2-5表示“论坛id2版块id5”',
  `forum_url` varchar(25) DEFAULT NULL,
  `qq` varchar(15) DEFAULT NULL,
  `weibo` varchar(25) DEFAULT NULL COMMENT '微博昵称',
  `weibo_url` varchar(25) DEFAULT NULL COMMENT '微博主页URL',
  `regtime` int(11) NOT NULL COMMENT '注册时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of lr_user
-- ----------------------------
INSERT INTO `lr_user` VALUES ('1', 'root', '鹳狸猿', '80cbb47567ddbd4525c9dbfb85787de4e3e2b45c', null, null, null, null, null, null, null, null, '1429348120');
INSERT INTO `lr_user` VALUES ('2', 'nimabi', 'nimabi', 'db18a68beb007d7c1c13922b9c6a219dd4470add', null, null, null, null, null, null, null, null, '1429387683');
INSERT INTO `lr_user` VALUES ('3', 'putong', 'putong', '554add0b3b1f2e299b81ee0f7191f3c65af8fc03', null, null, null, null, null, null, null, null, '1429475016');
